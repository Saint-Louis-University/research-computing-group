<!DOCTYPE html>
<html  lang="en-US">

<head>
  <meta charset="utf-8">
  <title>SLURM Examples</title>

  <meta name="generator" content="Hugo 0.53" />

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <!-- ** Plugins Needed for the Project ** -->
  <!-- Bootstrap -->
  <link rel="stylesheet" href="/research-computing-group/plugins/bootstrap/bootstrap.min.css">
  <!-- themefy-icon -->
  <link rel="stylesheet" href="/research-computing-group/plugins/themify-icons/themify-icons.css">
  <!-- highlight -->
  <link rel="stylesheet" href="/research-computing-group/plugins/highlight/hybrid.css">
  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">


  <style>
  :root{
    --primary-color:#003da5;
    --secondary-color:#f9f9f9;
    --text-color:#636363;
    --text-color-dark:#242738;
    --white-color:#ffffff;
  }  
  </style>


  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/research-computing-group/css/style.min.css" integrity="" media="screen">

  <!-- jquiry -->
  <script src="/research-computing-group/plugins/jquery/jquery-1.12.4.js"></script>

  <!-- jquary ui -->
  <script src="/research-computing-group/plugins/jquery/jquery-ui.js"></script>

  <!--Favicon-->
  <link rel="icon" href="/research-computing-group/images/favicon.png" type="image/x-icon">

</head>

<body>

<!-- navigation -->
<header class="shadow-bottom position-relative">
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light">
    <a class="navbar-brand" href="/research-computing-group/">SLU</a>
    <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link text-dark" href="/research-computing-group/">Home</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link text-dark" href="/research-computing-group/about">About</a>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            getting-started
          </a>
          <div class="dropdown-menu" >
            
            <a class="dropdown-item" href="/research-computing-group/gettingstarted">Getting Started</a>
            
            <a class="dropdown-item" href="/research-computing-group/getting-started/ftp/">FTP</a>
            
            <a class="dropdown-item" href="/research-computing-group/getting-started/ssh/">SSH</a>
            
            <a class="dropdown-item" href="/research-computing-group/getting-started/vpn/">VPN</a>
            
            <a class="dropdown-item" href="/research-computing-group/getting-started/vnc/">VNC</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            support
          </a>
          <div class="dropdown-menu" >
            
            <a class="dropdown-item" href="/research-computing-group/a-support">Support</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/application-installation/">Application Installation</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/compilers/">Compilers</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/infiniband/">Infiniband</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/r-language/">R Language</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/running-cluster/">Running Jobs on the Cluster</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/sas-spss-atlas/">SAS, SPSS, and ATLAS.ti</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/storage/">Storage</a>
            
            <a class="dropdown-item" href="/research-computing-group/support/python-versions/">Multiple Versions of Python</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            slurm
          </a>
          <div class="dropdown-menu" >
            
            <a class="dropdown-item" href="/research-computing-group/slurm/slurm-commands/">SLURM Commands</a>
            
            <a class="dropdown-item" href="/research-computing-group/slurm/slurm-examples/">SLURM Examples</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            apex
          </a>
          <div class="dropdown-menu" >
            
            <a class="dropdown-item" href="/research-computing-group/apex/apex/">APEX</a>
            
            <a class="dropdown-item" href="/research-computing-group/apex/hardware/">Hardware</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link text-dark" href="/research-computing-group/faq">FAQ</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link text-dark" href="/research-computing-group/contact">Contact</a>
        </li>
        
        
      </ul>
      
      <ul class="list-inline text-center mb-0">
        
        <li class="list-inline-item"><a class="text-dark" href="/research-computing-group/"></a></li>
        
      </ul>
    </div>
  </nav>
  </div>
</header>
<!-- /navigation -->



<section class="single pt-5 bg-gray">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="p-4 bg-white sticky-top">
            
            <nav class="sidebar-menu">
              <ul class="list-styled">
            <li class=""><a href="/research-computing-group/gettingstarted/">Getting Started</a>
            </li>
            <li class="parent d-block "><a href="/research-computing-group/slurm/">Slurms</a>
              <ul class="sub-menu">
            <li class=" active "><a href="/research-computing-group/slurm/slurm-examples/">SLURM Examples</a>
            </li>
            <li class=""><a href="/research-computing-group/slurm/slurm-commands/">SLURM Commands</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/research-computing-group/apex/">Apexes</a>
              <ul class="">
            <li class=""><a href="/research-computing-group/apex/apex/">APEX</a>
            </li>
            <li class=""><a href="/research-computing-group/apex/hardware/">Hardware</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/research-computing-group/getting-started/">Getting-starteds</a>
              <ul class="">
            <li class=""><a href="/research-computing-group/getting-started/ftp/">FTP</a>
            </li>
            <li class=""><a href="/research-computing-group/getting-started/ssh/">SSH</a>
            </li>
            <li class=""><a href="/research-computing-group/getting-started/vpn/">VPN</a>
            </li>
            <li class=""><a href="/research-computing-group/getting-started/vnc/">VNC</a>
            </li>
            <li class=""><a href="/research-computing-group/getting-started/vnc_subpage/">VNC Subpage</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/research-computing-group/support/">Supports</a>
              <ul class="">
            <li class=""><a href="/research-computing-group/support/application-installation/">Application Installation</a>
            </li>
            <li class=""><a href="/research-computing-group/support/compilers/">Compilers</a>
            </li>
            <li class=""><a href="/research-computing-group/support/infiniband/">Infiniband</a>
            </li>
            <li class=""><a href="/research-computing-group/support/python-versions/">Multiple Versions of Python</a>
            </li>
            <li class=""><a href="/research-computing-group/support/r-language/">R Language</a>
            </li>
            <li class=""><a href="/research-computing-group/support/running-cluster/">Running Jobs on the Cluster</a>
            </li>
            <li class=""><a href="/research-computing-group/support/sas-spss-atlas/">SAS, SPSS, and ATLAS.ti</a>
            </li>
            <li class=""><a href="/research-computing-group/support/storage/">Storage</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/research-computing-group/contact/">Contact</a>
            </li>
            <li class=""><a href="/research-computing-group/faq/">FAQ</a>
            </li>
            <li class=""><a href="/research-computing-group/qmon-tutorial/">Qmon Tutorial</a>
            </li>
            <li class=""><a href="/research-computing-group/a-support/">Support</a>
            </li>
            <li class=""><a href="/research-computing-group/about/">home</a>
            </li></ul>
            </nav>
    
            
        </div>
      </div>
      <div class="col-lg-9">
        <div class="p-5 bg-white">
            <h2>SLURM Examples</h2>
            

<h3 id="submission-script-examples">Submission script examples</h3>

<p>Here are some quick sample submission scripts. For more detailed information, make sure to have a look at the <a href="http://www.ceci-hpc.be/slurm_faq.html">Slurm FAQ</a> and to follow our <a href="http://www.ceci-hpc.be/training.html">training sessions</a>. There is also <a href="http://www.ceci-hpc.be/scriptgen.html">Script Generation Wizard</a> you can use to help you in submission scripts creation.</p>

<h3 id="message-passing-example-mpi">Message passing example (MPI)</h3>

<pre><code>#!/bin/bash
#
#SBATCH --job-name=test_mpi
#SBATCH --output=res_mpi.txt
#
#SBATCH --ntasks=4
#SBATCH --time=10:00

module load openmpi
mpirun hello.mpi
</code></pre>

<p>Request four cores on the cluster for 10 minutes, using 100 MB of RAM per core. Assuming my_mpi_program was compiled with MPI support, <span style="background-color:#ffffff;font-family:Comic Sans MS">mpirun</span> will create four instances of it, on the nodes allocated by Slurm.</p>

<p>You can try the above example by downloading the example <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface#Example_program">hello world program from Wikipedia</a> (name it for instance <span style="background-color:#ffffff;font-family:Comic Sans MS">wiki_mpi_example.c</span>), and compiling it with</p>

<pre><code>module load openmpi
mpicc wiki_mpi_example.c -o hello.mpi
</code></pre>

<p>The <span style="background-color:#ffffff">res_mpi.txt</span> file should contain something like</p>

<pre><code>0: We have 4 processors
0: Hello 1! Processor 1 reporting for duty

0: Hello 2! Processor 2 reporting for duty

0: Hello 3! Processor 3 reporting for duty
</code></pre>

<h3 id="shared-memory-example-openmp">Shared memory example (OpenMP)</h3>

<pre><code>#!/bin/bash
#
#SBATCH --job-name=test_omp
#SBATCH --output=res_omp.txt
#
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --time=10:00

export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK
./hello.omp
</code></pre>

<p>The job it will be run in an allocation where four cores have been reserved on the same compute node.</p>

<p>You can try it by using the <a href="https://en.wikipedia.org/wiki/OpenMP#C">hello world program from Wikipedia</a> (name it for instance wiki_omp_example.c) and compiling it with</p>

<pre><code>gcc -fopenmp wiki_omp_example.c -o hello.omp
</code></pre>

<p>The <span style="background-color:#ffffff">res_omp.txt</span> file should contain something like</p>

<pre><code>Hello World from thread 0
Hello World from thread 3
Hello World from thread 1
Hello World from thread 2
There are 4 threads
</code></pre>

<h3 id="embarrassingly-parallel-workload-example">Embarrassingly parallel workload example</h3>

<pre><code>#!/bin/bash
#
#SBATCH --job-name=test_emb
#SBATCH --output=res_emb.txt
#
#SBATCH --ntasks=4
#SBATCH --time=10:00

srun printenv SLURM_PROCID
</code></pre>

<p>In that configuration, the <span style="background-color:#ffffff">printenv</span> command will be run four times, and each will have its environment variable  <span style="background-color:#ffffff;font-family:Comic Sans MS">SLURM_PROCID</span> set to a distinct value.</p>

<p>This setup is useful if the program is based on <strong>random draws</strong> (e.g. Monte-Carlo simulations): the application permitting, you can have four programs drawing 1000 samples and combine their output (with another program) to get the equivalent of drawing 4000 samples.</p>

<p>Another typical use of this setting is <strong>parameter sweep</strong> where the same computation is carried on by each program except that some high-level parameter has distinct values in each case. Examples include optimisation of an integer-valued parameter through range scanning. In the latter case, each instance of the program simply has to lookup the <span style="background-color:#ffffff">$SLURM_PROCID</span> environment variable and decide, accordingly, what values of the parameter to test.</p>

<p>The same can be set up to process <strong>several data files</strong> for instance. Each instance of the program just has to decide which file to read based upon the value set in its <span style="background-color:#ffffff">$SLURM_PROCID</span> environment variable.</p>

<p>Upon completion, the above job will create a file <span style="background-color:#ffffff">test_emp</span> with four lines:</p>

<pre><code>0
1
2
3
</code></pre>

<h3 id="master-slave-program-example">Master/slave program example</h3>

<pre><code>#!/bin/bash
#
#SBATCH --job-name=test_ms
#SBATCH --output=res_ms.txt
#
#SBATCH --ntasks=4
#SBATCH --time=10:00
#SBATCH --mem-per-cpu=100

srun --multi-prog multi.conf
</code></pre>

<p>With file <em>multi.conf</em> being, for example, as follows</p>

<pre><code>0      echo     'I am the Master'
1-3    bash -c 'printenv SLURM_PROCID'
</code></pre>

<p>The above instructs Slurm to create four tasks (or processes), one running <span style="background-color:#ffffff">echo &lsquo;I am the Master&rsquo;</span>, and the other 3 running <span style="background-color:#ffffff">bash -c &lsquo;printenv SLURM_PROCID&rsquo;</span>. This is typically used in a <strong>producer/consumer</strong> setup where one program (the master) create computing tasks for the other program (the slaves) to perform.</p>

<p>Upon completion of the above job, file <span style="background-color:#ffffff">res_ms.txt</span> will contain</p>

<pre><code>I am the Master
1
2
3
</code></pre>

            <p class="post-meta border-bottom pb-3 mb-0">Updated on 25 Mar 2019</p><nav class="pagination mt-3"><a class="nav nav-prev" href="/research-computing-group/slurm/" title="Slurms"><i class="ti-arrow-left mr-2"></i>Slurms</a>
            <a class="nav nav-next" href="/research-computing-group/slurm/slurm-commands/" title="SLURM Commands">SLURM Commands<i class="ti-arrow-right ml-2"></i></a>
            </nav></div>
      </div>
    </div>
  </div>
</section>


<!-- footer -->
<footer class="section bg-gray pb-0">
  <div class="container">
    <div class="row">
      <div class="col-md-8 text-md-left text-center">
       
      </div>
      <div class="col-md-4 text-md-right text-center">
        <ul class="list-inline mb-3">
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- /footer -->

<!-- Bootstrap JS -->
<script src="/research-computing-group/plugins/bootstrap/bootstrap.min.js"></script>
<!-- highlight -->
<script src="/research-computing-group/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Main Script -->

<script src="/research-computing-group/js/script.min.js"></script>


</body>

</html>